---
import HeaderLink from "./HeaderLink.astro";
import { Text } from "./Text";
import ThemeToggle from "./ThemeToggle.astro";

const links = [
	["Blog", "/blog"],
	["Projects", "/projects"],
	["Contact", "/contact"],
] as const;
---

<div class="fader" role="presentation"></div>
<Text as="header" class="header" fontWeight="bold">
    <div class="header-container">
        <HeaderLink href="/" class="logo">Peace Teka</HeaderLink>
        
        <div class="flex items-center gap-4">
            <ThemeToggle class="theme-toggle hidden md:block" />
            <button 
                id="mobile-menu-button" 
                class="md:hidden p-2 -mr-2" 
                aria-label="Toggle menu"
                aria-expanded="false"
                aria-controls="mobile-menu"
            >
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="menu-icon">
                    <path d="M3 6H21M3 12H21M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
    </div>
    
    <nav id="mobile-menu" class="mobile-menu hidden md:block">
        <div class="links">
            {links.map(([text, href]) => (
                <HeaderLink href={href} class="nav-link block py-2 px-4 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">
                    {text}
                </HeaderLink>
            ))}
        </div>
    </nav>
</Text>

<style>
	/* Base header styles */
	header {
		display: flex;
		flex-direction: column;
		width: 100%;
		padding: 1rem var(--widthPagePadding);
		position: relative;
		background: var(--colorBackground);
		z-index: 50;
	}

	.header-container {
		display: flex;
		justify-content: space-between;
		align-items: center;
		width: 100%;
	}

	/* Logo styles */
	.logo {
		font-size: 1.25rem;
		font-weight: 700;
		color: var(--colorText);
		text-decoration: none;
	}

	/* Mobile menu button */
	#mobile-menu-button {
		display: flex;
		align-items: center;
		justify-content: center;
		padding: 0.5rem;
		color: var(--colorText);
		background: none;
		border: none;
		cursor: pointer;
		border-radius: 0.25rem;
		transition: background-color 0.2s;
	}

	#mobile-menu-button:hover {
		background-color: var(--colorBackgroundHover);
	}

	/* Navigation links */
	.mobile-menu {
		display: none;
		width: 100%;
		overflow: hidden;
		transition: all 0.3s ease-in-out;
	}

	.mobile-menu.active {
		display: block;
	}

	/* Desktop menu */
	@media (min-width: 768px) {
		.mobile-menu {
			display: block !important;
		}

		.links {
			flex-direction: row;
			align-items: center;
			justify-content: flex-end;
			gap: 1.5rem;
			padding: 0;
		}

		.nav-link {
			padding: 0.5rem 0.75rem;
			display: inline-block;
		}
	}

	/* Mobile menu */
	@media (max-width: 767px) {
		.mobile-menu {
			position: absolute;
			top: 100%;
			left: 0;
			right: 0;
			background: var(--colorBackground);
			box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
			padding: 0.5rem 1rem;
			border-top: 1px solid var(--colorBorder);
		}

		.links {
			display: flex;
			flex-direction: column;
			gap: 0.5rem;
			padding: 0.5rem 0;
		}

		.nav-link {
			padding: 0.75rem 1rem;
			border-radius: 0.375rem;
		}
	}
	}

	@media (min-width: 700px) {
		header {
			gap: 1.5rem;
			justify-content: space-between;
			max-width: calc(var(--widthFull) - 1rem);
			position: fixed;
			z-index: 1;
		}

		header::after,
		header::before {
			--horizontalBlur: -3.5rem;
			bottom: -1rem;
			content: "";
			filter: blur(1rem);
			left: var(--horizontalBlur);
			pointer-events: none;
			position: absolute;
			right: var(--horizontalBlur);
		}

		header::after {
			backdrop-filter: blur(20px);
			mask-image: linear-gradient(to bottom, black 50%, transparent);
			top: 0;
			z-index: -1;
		}

		header::before {
			background:
				radial-gradient(
						ellipse at top,
						var(--colorBackgroundTop) 0,
						transparent 100vh
					)
					no-repeat,
				radial-gradient(
						ellipse at top,
						var(--colorBackgroundTop) 0,
						transparent 100vh
					)
					no-repeat;
			content: "";
			top: -1.5rem;
		}

		.fader {
			background: linear-gradient(
				to bottom,
				var(--colorBackgroundTop),
				transparent 70%
			);
			height: var(--heightMinimumFromHeader);
			left: 5vw;
			pointer-events: none;
			position: fixed;
			right: 5vw;
			top: 0;
			user-select: none;
			mask-image: linear-gradient(
				to right,
				transparent 0%,
				white 10%,
				white 90%,
				transparent 100%
			);
			z-index: 1;
		}

		.first {
			flex-grow: 100;
			padding-right: 4rem;
			position: relative;
			width: initial;
		}

		.first::after {
			background: var(--colorForeground);
			content: "";
			display: block;
			height: 0.7rem;
			position: absolute;
			right: 1.5rem;
			top: 0.5rem;
			width: 1px;
		}

		.links {
			position: relative;
			gap: 1.5rem;
			justify-content: space-between;
		}
	}

	@media (min-width: 1017px) {
		header {
			padding: 2rem 0;
		}
	}
	.nav-link {
		display: block;
		padding: 0.5rem 0;
		color: var(--colorText);
		text-decoration: none;
		transition: color 0.2s ease;
	}

	.nav-link:hover {
		color: var(--colorPrimary);
	}

	/* Desktop styles */
	@media (min-width: 768px) {
		header {
			flex-direction: row;
			align-items: center;
			padding: 1.5rem var(--widthPagePadding);
		}

		#mobile-menu-button {
			display: none;
		}

		.mobile-menu {
			display: block !important;
			width: auto;
		}

		.links {
			flex-direction: row;
			gap: 1.5rem;
			padding: 0;
		}

		.nav-link {
			padding: 0.5rem 0.75rem;
		}
	}

	/* Dark mode support */
	@media (prefers-color-scheme: dark) {
		#mobile-menu-button {
			color: var(--colorText);
		}
	}
</style>

<script is:inline>
	document.addEventListener('DOMContentLoaded', () => {
		const menuButton = document.getElementById('mobile-menu-button');
		const mobileMenu = document.getElementById('mobile-menu');

		if (!menuButton || !mobileMenu) return;

		const toggleMenu = (show = null) => {
			const shouldShow = show !== null ? show : !mobileMenu.classList.contains('active');
			
			if (shouldShow) {
				mobileMenu.classList.add('active');
				menuButton.setAttribute('aria-expanded', 'true');
				document.body.style.overflow = 'hidden';
			} else {
				mobileMenu.classList.remove('active');
				menuButton.setAttribute('aria-expanded', 'false');
				document.body.style.overflow = '';
			}
		};

		// Toggle menu on button click
		menuButton.addEventListener('click', (e) => {
			e.stopPropagation();
			toggleMenu();
		});

		// Close menu when clicking outside
		document.addEventListener('click', (e) => {
			const target = e.target as HTMLElement;
			const isClickInside = target.closest('.header') || target === menuButton;
			
			if (!isClickInside && mobileMenu.classList.contains('active')) {
				toggleMenu(false);
			}
		});

		// Close menu when a link is clicked (for single page navigation)
		mobileMenu.querySelectorAll('a').forEach(link => {
			link.addEventListener('click', () => toggleMenu(false));
		});

		// Close menu on escape key
		document.addEventListener('keydown', (e) => {
			if (e.key === 'Escape' && mobileMenu.classList.contains('active')) {
				toggleMenu(false);
			}
		});

		// Handle window resize
		const handleResize = () => {
			if (window.innerWidth >= 768) {
				toggleMenu(false);
			}
		};

		// Add debounce to resize handler
		let resizeTimer;
		window.addEventListener('resize', () => {
			clearTimeout(resizeTimer);
			resizeTimer = setTimeout(handleResize, 100);
		});
	});
</script>
